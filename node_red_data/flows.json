[
    {
        "id": "a286e71930bddf50",
        "type": "tab",
        "label": "RSS Pipeline Stable",
        "disabled": false,
        "info": "Pipeline RSS + LLM avec n≈ìuds natifs Node-RED"
    },
    {
        "id": "7e081f306d97e6eb",
        "type": "group",
        "z": "a286e71930bddf50",
        "name": "SOURCES",
        "style": {
            "stroke": "#3f93cf",
            "fill": "#bfdbef",
            "label": true
        },
        "nodes": [
            "ced5a1942934a354",
            "b0628ca5f2bae48a",
            "d84a5bc5e8999686",
            "c9d1a9a53fa4d259",
            "5e0f8e9f4deb0d64",
            "81a2803f3e5a185f"
        ],
        "x": 514,
        "y": 99,
        "w": 272,
        "h": 382
    },
    {
        "id": "84c6e14812f48c18",
        "type": "group",
        "z": "a286e71930bddf50",
        "name": "Pr√©-traitement",
        "style": {
            "stroke": "#ffdf7f",
            "fill": "#ffefbf",
            "label": true
        },
        "nodes": [
            "1326f6c0ff564efe",
            "67e53dd386dc1fa0",
            "b8524d09134466d9",
            "4bde8394fcc94f98",
            "fe2411334b8e790e",
            "ff1249b485e6f9d6",
            "366b4fa1a98cc202"
        ],
        "x": 834,
        "y": 99,
        "w": 292,
        "h": 442
    },
    {
        "id": "6f583ff8a5c124d2",
        "type": "group",
        "z": "a286e71930bddf50",
        "name": "LLMs",
        "style": {
            "stroke": "#ff3f3f",
            "fill": "#ffbfbf",
            "label": true
        },
        "nodes": [
            "e8c2cbdd77973481",
            "31d5fa8a7e887603",
            "adda75fb4c9b6316"
        ],
        "x": 1174,
        "y": 99,
        "w": 252,
        "h": 202
    },
    {
        "id": "24a5d19a2bf69b70",
        "type": "group",
        "z": "a286e71930bddf50",
        "name": "CONFIGRUATION",
        "style": {
            "fill": "#d1d1d1",
            "label": true
        },
        "nodes": [
            "4d70a06815ee11b5",
            "3113abf5266df5a6",
            "a0962f8cd2076370"
        ],
        "x": 54,
        "y": 359,
        "w": 412,
        "h": 162
    },
    {
        "id": "6c76fb3fd0b8defb",
        "type": "group",
        "z": "a286e71930bddf50",
        "name": "OUTPUT",
        "style": {
            "label": true
        },
        "nodes": [
            "f1dcc003bee4cd3a",
            "ca4a2ad5526289b6"
        ],
        "x": 1494,
        "y": 399,
        "w": 212,
        "h": 142
    },
    {
        "id": "87fb0cb215ca48be",
        "type": "group",
        "z": "a286e71930bddf50",
        "name": "Post-traitement",
        "style": {
            "stroke": "#ffff3f",
            "fill": "#ffffbf",
            "label": true
        },
        "nodes": [
            "22ada62db320bf9b",
            "7769f131d6b901a6",
            "e4a5576ef4ec20da"
        ],
        "x": 1174,
        "y": 339,
        "w": 272,
        "h": 202
    },
    {
        "id": "4d70a06815ee11b5",
        "type": "inject",
        "z": "a286e71930bddf50",
        "g": "24a5d19a2bf69b70",
        "name": "üîÑ D√©marrer Pipeline",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 200,
        "y": 400,
        "wires": [
            [
                "a0962f8cd2076370"
            ]
        ]
    },
    {
        "id": "3113abf5266df5a6",
        "type": "inject",
        "z": "a286e71930bddf50",
        "g": "24a5d19a2bf69b70",
        "name": "‚è∞ Auto (30min)",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "1800",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 210,
        "y": 480,
        "wires": [
            [
                "a0962f8cd2076370"
            ]
        ]
    },
    {
        "id": "ced5a1942934a354",
        "type": "file in",
        "z": "a286e71930bddf50",
        "g": "7e081f306d97e6eb",
        "name": "üìÅ Charger sources.json",
        "filename": "/config/sources.json",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 650,
        "y": 440,
        "wires": [
            [
                "b0628ca5f2bae48a"
            ]
        ]
    },
    {
        "id": "b0628ca5f2bae48a",
        "type": "json",
        "z": "a286e71930bddf50",
        "g": "7e081f306d97e6eb",
        "name": "üîß Parser JSON",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 650,
        "y": 380,
        "wires": [
            [
                "d84a5bc5e8999686"
            ]
        ]
    },
    {
        "id": "d84a5bc5e8999686",
        "type": "change",
        "z": "a286e71930bddf50",
        "g": "7e081f306d97e6eb",
        "name": "üìù Extraire sources",
        "rules": [
            {
                "t": "move",
                "p": "payload.sources",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "categories",
                "pt": "msg",
                "to": "payload.categories",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 640,
        "y": 320,
        "wires": [
            [
                "c9d1a9a53fa4d259"
            ]
        ]
    },
    {
        "id": "c9d1a9a53fa4d259",
        "type": "split",
        "z": "a286e71930bddf50",
        "g": "7e081f306d97e6eb",
        "name": "üìã Split sources",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "topic",
        "x": 640,
        "y": 260,
        "wires": [
            [
                "5e0f8e9f4deb0d64"
            ]
        ]
    },
    {
        "id": "5e0f8e9f4deb0d64",
        "type": "function",
        "z": "a286e71930bddf50",
        "g": "7e081f306d97e6eb",
        "name": "üìù Pr√©parer URL",
        "func": "msg.url = msg.payload.url;\nmsg.sourceInfo = msg.payload;\nnode.warn(`üîÑ Traitement: ${msg.payload.name}`);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 200,
        "wires": [
            [
                "81a2803f3e5a185f"
            ]
        ]
    },
    {
        "id": "81a2803f3e5a185f",
        "type": "http request",
        "z": "a286e71930bddf50",
        "g": "7e081f306d97e6eb",
        "name": "üåê R√©cup√©rer RSS",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "User-Agent",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "RSS-Pipeline/2.0"
            }
        ],
        "x": 650,
        "y": 140,
        "wires": [
            [
                "4bde8394fcc94f98"
            ]
        ]
    },
    {
        "id": "1326f6c0ff564efe",
        "type": "function",
        "z": "a286e71930bddf50",
        "g": "84c6e14812f48c18",
        "name": "üìä Extraire articles",
        "func": "var rss = msg.payload;\nvar items = [];\n\nnode.warn(\"=== EXTRACTION SANS LIMITES ===\");\nnode.warn(`Source: ${msg.sourceInfo.name}`);\nnode.warn(\"Structure RSS re√ßue: \" + JSON.stringify(Object.keys(rss), null, 2));\n\n// Essayer diff√©rents formats RSS avec logging\nif (rss.rss && rss.rss.channel) {\n    node.warn(\"Format RSS 2.0 d√©tect√©\");\n    if (rss.rss.channel.item) {\n        items = rss.rss.channel.item;\n        node.warn(\"Items trouv√©s dans rss.rss.channel.item\");\n    }\n} else if (rss.feed) {\n    node.warn(\"Format Atom d√©tect√©\");\n    if (rss.feed.entry) {\n        items = rss.feed.entry;\n        node.warn(\"Items trouv√©s dans rss.feed.entry\");\n    }\n} else if (rss.channel) {\n    node.warn(\"Format RSS direct d√©tect√©\");\n    if (rss.channel.item) {\n        items = rss.channel.item;\n        node.warn(\"Items trouv√©s dans rss.channel.item\");\n    }\n} else {\n    node.warn(\"Structure RSS: \" + JSON.stringify(rss, null, 2).substring(0, 500));\n    return null;\n}\n\n// Convertir en array si un seul item\nif (!Array.isArray(items)) {\n    items = [items];\n}\n\n// ‚úÖ LIMITATION STRICTE PAR SOURCE\nvar sourceConfig = msg.sourceConfig || {};\nvar sourceName = msg.sourceInfo.name;\nvar maxForThisSource = sourceConfig[sourceName] ? sourceConfig[sourceName].maxArticles : 5;\n\n// Limitation absolue\nif (items.length > maxForThisSource) {\n    items = items.slice(0, maxForThisSource);\n    node.warn(`‚úÇÔ∏è LIMITATION: ${maxForThisSource} articles de ${sourceName} (${items.length} dispos)`);\n} else {\n    node.warn(`üì∞ TOUS LES ${items.length} articles de ${sourceName}`);\n}\n\nif (items.length === 0) {\n    node.warn(\"Aucun article trouv√©\");\n    return null;\n}\n\n// Statistiques d√©taill√©es\nmsg.payload = items;\nmsg.sourceStats = {\n    source: msg.sourceInfo.name,\n    totalArticles: items.length,\n    processingMode: items.length > 20 ? 'limit√©' : 'complet'\n};\n\nnode.warn(`‚úÖ ${msg.sourceInfo.name}: ${items.length} articles √† traiter`);\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 200,
        "wires": [
            [
                "67e53dd386dc1fa0"
            ]
        ]
    },
    {
        "id": "67e53dd386dc1fa0",
        "type": "split",
        "z": "a286e71930bddf50",
        "g": "84c6e14812f48c18",
        "name": "üìã Split articles",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "property": "payload",
        "x": 960,
        "y": 260,
        "wires": [
            [
                "366b4fa1a98cc202"
            ]
        ]
    },
    {
        "id": "b8524d09134466d9",
        "type": "change",
        "z": "a286e71930bddf50",
        "g": "84c6e14812f48c18",
        "name": "üìù Construire article",
        "rules": [
            {
                "t": "set",
                "p": "article.title",
                "pt": "msg",
                "to": "payload.title",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "article.link",
                "pt": "msg",
                "to": "payload.link",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "article.description",
                "pt": "msg",
                "to": "payload.description",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "article.source",
                "pt": "msg",
                "to": "sourceInfo.name",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "article.category",
                "pt": "msg",
                "to": "sourceInfo.category",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "article.pubDate",
                "pt": "msg",
                "to": "payload.pubDate",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "article.keywords",
                "pt": "msg",
                "to": "sourceInfo.keywords",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 960,
        "y": 380,
        "wires": [
            [
                "ff1249b485e6f9d6"
            ]
        ]
    },
    {
        "id": "4bde8394fcc94f98",
        "type": "function",
        "z": "a286e71930bddf50",
        "g": "84c6e14812f48c18",
        "name": "Parser RSS",
        "func": "// Code pour remplacer dans le n≈ìud \"Parser RSS\" (4bde8394fcc94f98)\nvar xmlString = msg.payload;\n\nif (typeof xmlString !== 'string') {\n    node.error(\"RSS n'est pas une cha√Æne\");\n    return null;\n}\n\nnode.warn(`üìÑ RSS re√ßu: ${xmlString.length} caract√®res de ${msg.sourceInfo.name}`);\n\ntry {\n    var items = [];\n    \n    // Extraire tous les <item>...</item>\n    var itemMatches = xmlString.match(/<item[^>]*>[\\s\\S]*?<\\/item>/gi) || [];\n    \n    node.warn(`üîç ${itemMatches.length} items trouv√©s dans ${msg.sourceInfo.name}`);\n    \n    // === FONCTION PARSING DATES ROBUSTE ===\n    function parsePublicationDate(itemXml) {\n        // Ordre de priorit√© des champs de date (√©largi)\n        const dateFields = ['pubDate', 'published', 'dc:date', 'date', 'updated', 'lastBuildDate', 'pubdate'];\n        \n        node.warn(\"=== DEBUG DATE ===\");\n        node.warn(\"XML item complet: \" + itemXml);\n        \n        for (var i = 0; i < dateFields.length; i++) {\n            var field = dateFields[i];\n            var regex = new RegExp('<' + field + '[^>]*>([\\\\s\\\\S]*?)<\\\\/' + field + '>', 'i');\n            var match = itemXml.match(regex);\n            \n            node.warn('Champ ' + field + ': ' + (match ? 'TROUV√â' : 'non trouv√©'));\n            \n            if (match && match[1]) {\n                let dateStr = match[1].replace(/<!\\[CDATA\\[([\\s\\S]*?)\\]\\]>/g, '$1').trim();\n                node.warn(`Date brute trouv√©e (${field}): \"${dateStr}\"`);\n                \n                try {\n                    // Nettoyer formats RSS courants\n                    dateStr = dateStr.replace(/\\s*\\([^)]*\\)$/, ''); // Supprimer timezone en fin\n                    \n                    const parsedDate = new Date(dateStr);\n                    node.warn(`Date pars√©e: ${parsedDate.toString()}`);\n                    \n                    if (!isNaN(parsedDate.getTime())) {\n                        // V√©rifier que la date n'est pas dans le futur lointain\n                        var now = new Date();\n                        var oneMonthFuture = new Date(now.getTime() + (30 * 24 * 60 * 60 * 1000));\n                        \n                        // Configuration flexible pour les limites de date\n                        var acceptHistorical = msg.acceptHistorical || false;\n                        var minDate = acceptHistorical ? \n                            new Date('2010-01-01') : \n                            new Date(now.getFullYear() - 1, 0, 1); // 1 an par d√©faut\n                        \n                        if (parsedDate >= minDate && parsedDate <= oneMonthFuture) {\n                            node.warn('‚úÖ Date valide utilis√©e: ' + parsedDate.toISOString());\n                            return parsedDate.toISOString();\n                        } else {\n                            node.warn('‚ö†Ô∏è Date hors plage (' + minDate.getFullYear() + '-' + now.getFullYear() + '): ' + parsedDate.toISOString());\n                        }\n                    } else {\n                        node.warn(`‚ùå Date invalide apr√®s parsing`);\n                    }\n                } catch (e) {\n                    node.warn(`‚ùå Erreur parsing: ${e.message}`);\n                }\n            }\n        }\n        \n        // Fallback: date actuelle si aucune date valide trouv√©e\n        const fallbackDate = new Date().toISOString();\n        node.warn(`‚ö†Ô∏è FALLBACK utilis√©: ${fallbackDate}`);\n        return fallbackDate;\n    }\n    \n    // Parser chaque item SANS AUCUNE LIMITATION\n    itemMatches.forEach((itemXml, index) => {\n        \n        // Extraction avec gestion CDATA compl√®te\n        function extractTag(xml, tagName) {\n            var regex = new RegExp(`<${tagName}[^>]*>([\\\\s\\\\S]*?)<\\\\/${tagName}>`, 'i');\n            var match = xml.match(regex);\n            if (match && match[1]) {\n                var content = match[1];\n                // Nettoyer CDATA\n                content = content.replace(/<!\\[CDATA\\[([\\s\\S]*?)\\]\\]>/g, '$1');\n                return content.trim();\n            }\n            return '';\n        }\n        \n        // Extraction compl√®te de tous les champs\n        var title = extractTag(itemXml, 'title') || 'Titre manquant';\n        var link = extractTag(itemXml, 'link') || '#';\n        var description = extractTag(itemXml, 'description') || '';\n        var content = extractTag(itemXml, 'content:encoded') || extractTag(itemXml, 'content') || '';\n        var summary = extractTag(itemXml, 'summary') || '';\n        var guid = extractTag(itemXml, 'guid') || '';\n        var author = extractTag(itemXml, 'author') || extractTag(itemXml, 'dc:creator') || '';\n        var category = extractTag(itemXml, 'category') || '';\n        \n        // === PARSING DATE INTELLIGENT ===\n        var pubDate = parsePublicationDate(itemXml);\n        \n        // Nettoyage HTML minimal (garder le contenu complet)\n        title = title.replace(/<[^>]*>/g, '').trim();\n        \n        // Priorit√© du contenu : content:encoded > description > summary\n        var fullContent = '';\n        if (content && content.length > 0) {\n            fullContent = content;\n            node.warn(`üìù Utilisation content:encoded (${content.length} chars)`);\n        } else if (description && description.length > 0) {\n            fullContent = description;\n            node.warn(`üìù Utilisation description (${description.length} chars)`);\n        } else if (summary && summary.length > 0) {\n            fullContent = summary;\n            node.warn(`üìù Utilisation summary (${summary.length} chars)`);\n        }\n        \n        // Nettoyage HTML mais CONSERVATION DU TEXTE COMPLET\n        fullContent = fullContent.replace(/<script[^>]*>.*?<\\/script>/gi, '')\n                                 .replace(/<style[^>]*>.*?<\\/style>/gi, '')\n                                 .replace(/<[^>]*>/g, ' ')\n                                 .replace(/&nbsp;/g, ' ')\n                                 .replace(/&amp;/g, '&')\n                                 .replace(/&lt;/g, '<')\n                                 .replace(/&gt;/g, '>')\n                                 .replace(/&quot;/g, '\"')\n                                 .replace(/&#39;/g, \"'\")\n                                 .replace(/\\s+/g, ' ')\n                                 .trim();\n        \n        var article = {\n            title: title,\n            link: link,\n            description: fullContent,\n            fullContent: fullContent,\n            originalDescription: description,\n            originalContent: content,\n            summary: summary,\n            pubDate: pubDate,                           // ‚úÖ DATE DE PUBLICATION R√âELLE\n            pubDateParsed: new Date(pubDate),          // ‚úÖ OBJET DATE POUR TRI\n            guid: guid,\n            author: author,\n            originalCategory: category,\n            contentLength: fullContent.length,\n            hasRichContent: content.length > description.length\n        };\n        \n        items.push(article);\n        \n        node.warn(`üìã ${index + 1}. \"${title.substring(0, 60)}...\" [${pubDate.split('T')[0]}]`);\n    });\n    \n    if (items.length === 0) {\n        node.warn(\"‚ùå Aucun article extrait\");\n        return null;\n    }\n    \n    // === TRI PAR DATE DE PUBLICATION (PLUS R√âCENT EN PREMIER) ===\n    items.sort(function(a, b) {\n        var dateA = new Date(a.pubDate);\n        var dateB = new Date(b.pubDate);\n        \n        // V√©rifier que les dates sont valides\n        if (isNaN(dateA.getTime())) dateA = new Date();\n        if (isNaN(dateB.getTime())) dateB = new Date();\n        \n        return dateB.getTime() - dateA.getTime();\n    });\n    node.warn(`üîÑ Articles tri√©s par date de publication`);\n    \n    // Simuler la structure attendue par le reste du flux\n    msg.payload = {\n        rss: {\n            channel: {\n                item: items\n            }\n        }\n    };\n    \n    // Statistiques avec dates\n    var dateRange = items.length > 1 ? \n        items[items.length-1].pubDate.split('T')[0] + ' √† ' + items[0].pubDate.split('T')[0] :\n        items[0].pubDate.split('T')[0];\n    \n    msg.contentStats = {\n        source: msg.sourceInfo.name,\n        totalArticles: items.length,\n        dateRange: dateRange,\n        oldestArticle: items[items.length-1].pubDate,\n        newestArticle: items[0].pubDate,\n        totalCharacters: items.reduce((sum, item) => sum + item.contentLength, 0)\n    };\n    \n    node.warn(`‚úÖ ${items.length} articles extraits et tri√©s par date`);\n    node.warn(`üìÖ P√©riode: ${dateRange}`);\n    \n    return msg;\n    \n} catch (error) {\n    node.error(\"Erreur parsing RSS: \" + error.message);\n    return null;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 140,
        "wires": [
            [
                "1326f6c0ff564efe"
            ]
        ]
    },
    {
        "id": "fe2411334b8e790e",
        "type": "function",
        "z": "a286e71930bddf50",
        "g": "84c6e14812f48c18",
        "name": "üìù Formatter Article",
        "func": "// === CHARGEMENT DE LA CONFIGURATION DES SOURCES ===\nlet sourcesConfig = [];\ntry {\n    const fs = global.get('fs') || require('fs');\n    const sourcesData = fs.readFileSync('/config/sources.json', 'utf8');\n    const config = JSON.parse(sourcesData);\n    sourcesConfig = config.sources || [];\n    node.warn(`üìã ${sourcesConfig.length} sources configur√©es charg√©es`);\n} catch (error) {\n    node.warn(\"‚ö†Ô∏è Impossible de charger sources.json, utilisation des valeurs par d√©faut\");\n    sourcesConfig = [];\n}\n\n// === TRAITEMENT DES DONN√âES ARTICLE ===\nconst article = msg.article;\n\n// V√©rification que l'article existe\nif (!article || typeof article !== 'object') {\n    node.error(\"msg.article manquant ou invalide\");\n    return null;\n}\n\n// === D√âTECTION AUTOMATIQUE DE LA SOURCE (sans URL) ===\nconst link = (msg.topic && typeof msg.topic === 'string') \n    ? msg.topic\n    : (article.link && typeof article.link === 'string') \n        ? article.link \n        : '#';\n\n// Fonction utilitaire pour extraire le hostname\nfunction extractHostname(url) {\n    try {\n        // Supprimer le protocole\n        let hostname = url.replace(/^https?:\\/\\//, '');\n        // Supprimer le chemin\n        hostname = hostname.split('/')[0];\n        // Supprimer le port si pr√©sent\n        hostname = hostname.split(':')[0];\n        return hostname.toLowerCase();\n    } catch (e) {\n        return '';\n    }\n}\n\n// Trouver la source correspondante\nlet detectedSource = null;\nconst articleHostname = extractHostname(link);\n\nfor (const source of sourcesConfig) {\n    const sourceHostname = extractHostname(source.url);\n    \n    if (articleHostname === sourceHostname || \n        articleHostname.includes(sourceHostname) || \n        link.toLowerCase().includes(sourceHostname)) {\n        detectedSource = source;\n        break;\n    }\n}\n\n// Source par d√©faut si non d√©tect√©e\nif (!detectedSource) {\n    // Essayer de deviner la source depuis l'URL\n    if (link.includes('openai.com')) {\n        detectedSource = { name: \"OpenAI Blog\", category: \"ia\", keywords: [] };\n    } else if (link.includes('huggingface.co')) {\n        detectedSource = { name: \"Hugging Face\", category: \"ia\", keywords: [] };\n    } else if (link.includes('github.')) {\n        detectedSource = { name: \"GitHub\", category: \"dev\", keywords: [] };\n    } else if (link.includes('aws.amazon.com')) {\n        detectedSource = { name: \"AWS\", category: \"cloud\", keywords: [] };\n    } else {\n        detectedSource = {\n            name: \"Source Inconnue\",\n            category: \"autre\",\n            keywords: []\n        };\n    }\n}\n\nnode.warn(`üîç Source d√©tect√©e: ${detectedSource.name} (${detectedSource.category})`);\n\n// === EXTRACTION S√âCURIS√âE DES DONN√âES ===\nconst title = (article.title && typeof article.title === 'string') \n    ? article.title \n    : 'Titre manquant';\n\nconst description = (typeof msg.payload === 'string' && msg.payload.length > 0) \n    ? msg.payload\n    : (article.description && typeof article.description === 'string') \n        ? article.description\n        : (article.summary && typeof article.summary === 'string') \n            ? article.summary \n            : 'Description manquante';\n\nconst pubDate = article.pubDate || article.pubDate || article.date || new Date().toISOString();\n\n// === NETTOYAGE ET FORMATAGE ===\nconst cleanDescription = description.replace(/<[^>]*>/g, '').trim().substring(0, 800);\n\n// V√©rification finale\nif (title === 'Titre manquant' || cleanDescription === 'Description manquante' || cleanDescription.length === 0) {\n    node.warn(\"‚ö†Ô∏è Article avec donn√©es incompl√®tes, on passe au suivant\");\n    return null;\n}\n\n// === EXTRACTION INTELLIGENTE DU TITRE (sans URL) ===\nlet finalTitle = title;\n\nif (title === 'Titre manquant' && link !== '#') {\n    // Extraction simple par manipulation de cha√Æne\n    try {\n        let pathname = link;\n        \n        // Supprimer le protocole et le hostname\n        if (pathname.includes('://')) {\n            const parts = pathname.split('://')[1].split('/');\n            pathname = '/' + parts.slice(1).join('/');\n        }\n        \n        // Diff√©rentes strat√©gies selon la source\n        if (pathname.includes('/index/')) {\n            // Format OpenAI: /index/nom-article\n            const urlParts = pathname.split('/index/')[1];\n            if (urlParts) {\n                finalTitle = urlParts.split('?')[0].replace(/-/g, ' ');\n                finalTitle = finalTitle.charAt(0).toUpperCase() + finalTitle.slice(1);\n            }\n        } else if (pathname.includes('/blog/')) {\n            // Format blog standard: /blog/nom-article\n            const urlParts = pathname.split('/blog/')[1];\n            if (urlParts) {\n                finalTitle = urlParts.split('?')[0].replace(/-/g, ' ');\n                finalTitle = finalTitle.charAt(0).toUpperCase() + finalTitle.slice(1);\n            }\n        } else {\n            // Extraction g√©n√©rale du dernier segment\n            const segments = pathname.split('/').filter(s => s.length > 0);\n            if (segments.length > 0) {\n                const lastSegment = segments[segments.length - 1];\n                finalTitle = lastSegment.split('?')[0].replace(/-/g, ' ');\n                finalTitle = finalTitle.charAt(0).toUpperCase() + finalTitle.slice(1);\n            }\n        }\n        \n        node.warn(`üîß Titre extrait de l'URL: ${finalTitle}`);\n    } catch (e) {\n        node.warn(\"‚ö†Ô∏è Impossible d'extraire le titre de l'URL: \" + e.message);\n    }\n}\n\n// === PR√âPARATION DES DONN√âES FINALES ===\nmsg.article = {\n    title: finalTitle,\n    description: cleanDescription,\n    link: link,\n    pubDate: pubDate,\n    source: detectedSource.name,\n    sourceCategory: detectedSource.category,\n    category: detectedSource.category\n};\n\nmsg.payload = {\n    title: finalTitle,\n    content: cleanDescription,\n    source_info: {\n        name: detectedSource.name,\n        category: detectedSource.category,\n        keywords: detectedSource.keywords || [],\n        url: link\n    }\n};\n\nnode.warn(`‚úÖ Article trait√©: ${finalTitle.substring(0, 50)}...`);\nnode.warn(`üìÇ Source: ${detectedSource.name}`);\nnode.warn(`üè∑Ô∏è Cat√©gorie par d√©faut: ${detectedSource.category}`);\nnode.warn(`üìÑ Description: ${cleanDescription.substring(0, 100)}...`);\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 980,
        "y": 500,
        "wires": [
            [
                "e8c2cbdd77973481"
            ]
        ]
    },
    {
        "id": "e8c2cbdd77973481",
        "type": "http request",
        "z": "a286e71930bddf50",
        "g": "6f583ff8a5c124d2",
        "name": "üß† M√©tadonn√©es v2",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "http://llm-service:5000/generate_metadata",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "Content-Type",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "application/json"
            }
        ],
        "x": 1300,
        "y": 140,
        "wires": [
            [
                "31d5fa8a7e887603"
            ]
        ]
    },
    {
        "id": "31d5fa8a7e887603",
        "type": "function",
        "z": "a286e71930bddf50",
        "g": "6f583ff8a5c124d2",
        "name": "üîÑ Pr√©parer R√©sum√©",
        "func": "const article = msg.article;\nconst metadata = msg.payload; // M√©tadonn√©es v2\n\n// Stocker les m√©tadonn√©es\nmsg.classification_v2 = metadata;\n\n// Mise √† jour domaine\narticle.domain = metadata.domain;\n\n// Pr√©paration r√©sum√© avec domaine\nmsg.payload = {\n    title: article.title,\n    content: article.description,\n    domain: metadata.domain\n};\n\nnode.warn(`üè∑Ô∏è Domaine v2: ${metadata.domain_label}`);\nnode.warn(`${metadata.alert_level === 'critical' ? 'üî¥' : 'üìä'} Alerte: ${metadata.alert_level}`);\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1300,
        "y": 200,
        "wires": [
            [
                "adda75fb4c9b6316"
            ]
        ]
    },
    {
        "id": "adda75fb4c9b6316",
        "type": "http request",
        "z": "a286e71930bddf50",
        "g": "6f583ff8a5c124d2",
        "name": "‚úçÔ∏è R√©sum√©",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "http://llm-service:5000/summarize_v2",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "Content-Type",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "application/json"
            }
        ],
        "x": 1310,
        "y": 260,
        "wires": [
            [
                "22ada62db320bf9b"
            ]
        ]
    },
    {
        "id": "e4a5576ef4ec20da",
        "type": "function",
        "z": "a286e71930bddf50",
        "g": "87fb0cb215ca48be",
        "name": "üíæ Cr√©er Markdown",
        "func": "// Code pour remplacer dans le n≈ìud \"üíæ Cr√©er Markdown\" (e4a5576ef4ec20da)\nconst article = msg.article;\nconst metadata = msg.classification_v2;\nconst summaryResult = msg.payload;\n\n// === UTILISATION DATE DE PUBLICATION R√âELLE ===\nconst pubDate = new Date(article.pubDate);\nconst now = new Date();\n\n// Formatage dates avec date de publication\nconst pubDateStr = pubDate.toISOString().split('T')[0];      // YYYY-MM-DD publication\nconst pubTimeStr = pubDate.toISOString().split('T')[1].split('.')[0];\nconst processedStr = now.toISOString().split('T')[0];        // Date traitement\nconst processedTimeStr = now.toISOString().split('T')[1].split('.')[0];\n\n// === STRUCTURE HI√âRARCHIQUE PAR DATE ===\nconst year = pubDate.getFullYear();\nconst month = String(pubDate.getMonth() + 1).padStart(2, '0');\n\n// Nom de fichier avec DATE DE PUBLICATION\nconst safeTitle = article.title.replace(/[^a-zA-Z0-9√Ä-√ø\\s]/g, '').substring(0, 40).replace(/\\s+/g, '_');\nconst fileName = `${pubDateStr}_${safeTitle}.md`;\n\n// Emojis par domaine\nconst domainEmojis = {\n    'veille_fraude': 'üö®',\n    'innovation_tech': 'üöÄ', \n    'finance_crypto': 'üí∞',\n    'actualite_tech': 'üì±'\n};\n\nconst alertEmojis = {\n    'critical': 'üî¥',\n    'alert': 'üü°', \n    'watch': '‚ö†Ô∏è',\n    'info': 'üìä'\n};\n\nconst domainEmoji = domainEmojis[metadata.domain] || 'üì∞';\nconst alertEmoji = alertEmojis[metadata.alert_level] || 'üìä';\n\n// === CONTENU MARKDOWN AVEC VRAIES DATES ===\nconst markdown = `---\ntitle: \"${article.title.replace(/\"/g, '\\\\\"')}\"\nsource: \"${article.source}\"\ndomain: \"${metadata.domain}\"\ndomain_label: \"${metadata.domain_label}\"\nclassification_v2: true\npublication_date: ${article.pubDate}                    # ‚úÖ DATE PUBLICATION R√âELLE\nprocessed_date: ${now.toISOString()}                    # Date de traitement\nurl: \"${article.link}\"\ntags: ${JSON.stringify(['rss', metadata.domain, ...metadata.strategic_tags])}\nobsidian_concepts: ${JSON.stringify(metadata.obsidian_concepts)}\nstrategic_tags: ${JSON.stringify(metadata.strategic_tags)}\nalert_level: \"${metadata.alert_level}\"\nconfidence: ${metadata.confidence}\ndate_hierarchy:\n  year: ${year}\n  month: ${month}\n  date_key: \"${pubDateStr}\"\nprocessing_stats:\n  method: \"${metadata.classification_method}\"\n  processing_time: \"${metadata.processing_time}s\"\n  version: \"${metadata.version}\"\n---\n# ${domainEmoji} ${article.title}\n\n> **${metadata.domain_label}** | **${article.source}** | üìÖ **${pubDateStr}** | ${alertEmoji} ${metadata.alert_level}\n\n${summaryResult.summary}\n\n## üîó Informations\n\n- **Source** : ${article.source}\n- **Domaine** : ${metadata.domain_label} (\\`${metadata.domain}\\`)\n- **üìÖ Date de publication** : **${pubDateStr}** ${pubTimeStr}\n- **URL originale** : [üìñ Lire l'article complet](${article.link})\n- **Niveau d'alerte** : ${alertEmoji} ${metadata.alert_level}\n- **‚öôÔ∏è Trait√© le** : ${processedStr} ${processedTimeStr}\n\n## üóìÔ∏è Navigation Temporelle\n\n### Articles du m√™me p√©riode\n- [[Articles ${year}/${month}]] ‚Ä¢ [[Timeline ${year}]]\n- [[Veille ${pubDateStr}]] ‚Ä¢ [[Derniers Articles]]\n\n## üß† R√©seau de Connaissances\n\n### Concepts li√©s\n${metadata.obsidian_concepts.map(concept => `- [[${concept}]]`).join('\\n')}\n\n### Navigation strat√©gique  \n- [[${metadata.domain_label} - Index]] ‚Ä¢ [[MOC Veille 2025]]\n- [[Trends ${metadata.domain}]] ‚Ä¢ [[Analytics Dashboard]]\n\n### Tags de veille\n${metadata.strategic_tags.join(' ')} \n\n## üìù Contenu\n\n${article.description}\n\n---\n\n## üîÑ M√©tadonn√©es Pipeline\n\n<details>\n<summary>üìä Informations de traitement v2.0</summary>\n\n- **Version** : Syst√®me Hybride v2.0 + Dates\n- **Classification** : ${metadata.classification_method}\n- **Confiance** : ${metadata.confidence}%\n- **Temps de traitement** : ${metadata.processing_time}s\n- **üìÖ Publication** : ${pubDateStr} ${pubTimeStr}\n- **‚öôÔ∏è Traitement** : ${processedStr} ${processedTimeStr}\n- **D√©lai traitement** : ${Math.round((now.getTime() - pubDate.getTime()) / (1000 * 60 * 60 * 24))} jours\n- **Domaine d√©tect√©** : ${metadata.domain}\n- **Liens g√©n√©r√©s** : ${metadata.obsidian_concepts.length}\n- **Tags strat√©giques** : ${metadata.strategic_tags.length}\n- **Fichier** : \\`${fileName}\\`\n\n</details>\n\n## üìà Actions de Suivi\n\n- [ ] Analyser l'impact strat√©gique\n- [ ] V√©rifier les connexions avec [[Projets en cours]]\n- [ ] Mettre √† jour [[Tableau de Bord Veille]]\n- [ ] Partager si pertinence > seuil critique\n\n---\n\n*Analys√© automatiquement par Pipeline RSS + LLM v2.0 ‚Ä¢ Publi√©: ${pubDateStr} ‚Ä¢ Trait√©: ${processedStr}*\n\n<!-- Navigation temporelle -->\n[[‚óÄÔ∏è ${pubDateStr}]] | [[üìÖ Archives ${year}/${month}]] | [[${pubDateStr} ‚ñ∂Ô∏è]]`;\n\n// === STRUCTURE DOSSIERS HI√âRARCHIQUE ===\nconst outputFolder = metadata.domain || 'actualite_tech';\n\n// Option 1: Hi√©rarchie par ann√©e/mois\nmsg.filename = `/obsidian_vault/articles/${outputFolder}/${year}/${month}/${fileName}`;\n\n// Option 2: Simple avec pr√©fixe date (moins invasive)\n// msg.filename = `/obsidian_vault/articles/${outputFolder}/${fileName}`;\n\nmsg.payload = markdown;\n\n// Debug avec dates\nnode.warn(`üìÅ DOSSIER: ${outputFolder}/${year}/${month}/${fileName}`);\nnode.warn(`üìÖ PUB: ${pubDateStr} | TRAIT√â: ${processedStr}`);\nnode.warn(`${domainEmoji} DOMAINE: ${metadata.domain_label}`);\nnode.warn(`${alertEmoji} ALERTE: ${metadata.alert_level}`);\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1320,
        "y": 500,
        "wires": [
            [
                "ca4a2ad5526289b6"
            ]
        ]
    },
    {
        "id": "f1dcc003bee4cd3a",
        "type": "debug",
        "z": "a286e71930bddf50",
        "g": "6c76fb3fd0b8defb",
        "name": "‚úÖ Succ√®s",
        "active": true,
        "complete": "filename",
        "x": 1590,
        "y": 440,
        "wires": []
    },
    {
        "id": "ca4a2ad5526289b6",
        "type": "file",
        "z": "a286e71930bddf50",
        "g": "6c76fb3fd0b8defb",
        "name": "",
        "filename": "filename",
        "filenameType": "msg",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "utf8",
        "x": 1600,
        "y": 500,
        "wires": [
            [
                "f1dcc003bee4cd3a"
            ]
        ]
    },
    {
        "id": "ff1249b485e6f9d6",
        "type": "function",
        "z": "a286e71930bddf50",
        "g": "84c6e14812f48c18",
        "name": "üîÑ Pr√©parer Classification",
        "func": "// V√©rification robuste\nif (!msg.article.title || !msg.article.description) {\n    node.error(`‚ùå Classification impossible - donn√©es manquantes`);\n    return null;\n}\n\nmsg.url = \"http://llm-service:5000/classify\";\n\n// TEXTE COMPLET POUR LE LLM - PAS DE LIMITATION\nmsg.payload = {\n    title: msg.article.title,\n    content: msg.article.description, // TEXTE COMPLET !\n    source_info: {\n        name: msg.article.source,\n        category: msg.article.category\n    }\n};\n\nnode.warn(`üîç Classification: ${msg.article.title.substring(0, 50)}...`);\nnode.warn(`üìä Contenu: ${msg.payload.content.length} caract√®res (COMPLET)`);\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 980,
        "y": 440,
        "wires": [
            [
                "fe2411334b8e790e"
            ]
        ]
    },
    {
        "id": "22ada62db320bf9b",
        "type": "function",
        "z": "a286e71930bddf50",
        "g": "87fb0cb215ca48be",
        "name": "üîÑ Traiter R√©sum√©",
        "func": "// R√©cup√©rer le r√©sum√© du LLM\nconst summaryResult = msg.payload;\n\n// Ajouter le r√©sum√© √† l'article\nif (summaryResult.summary) {\n    msg.article.summary = summaryResult.summary;\n} else {\n    msg.article.summary = \"R√©sum√© non disponible\";\n}\n\n// Remettre l'article en payload pour la suite\nmsg.payload = msg.article;\n\nnode.warn(`‚úÖ R√©sum√© ajout√©: ${msg.article.summary.substring(0, 50)}...`);\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1290,
        "y": 380,
        "wires": [
            [
                "7769f131d6b901a6"
            ]
        ]
    },
    {
        "id": "7769f131d6b901a6",
        "type": "function",
        "z": "a286e71930bddf50",
        "g": "87fb0cb215ca48be",
        "name": "üßπ Nettoyer donn√©es",
        "func": "// Nettoyer le titre\nif (msg.article.title) {\n    if (typeof msg.article.title === 'object' && msg.article.title._) {\n        msg.article.title = msg.article.title._;\n    }\n    msg.article.title = String(msg.article.title).replace(/<[^>]*>/g, '').trim();\n}\n\n// Nettoyer la description\nif (msg.article.description) {\n    if (typeof msg.article.description === 'object' && msg.article.description._) {\n        msg.article.description = msg.article.description._;\n    }\n    msg.article.description = String(msg.article.description).replace(/<[^>]*>/g, '').trim();\n}\n\n// Nettoyer le lien\nif (msg.article.link) {\n    if (typeof msg.article.link === 'object' && msg.article.link._) {\n        msg.article.link = msg.article.link._;\n    }\n    msg.article.link = String(msg.article.link).trim();\n}\n\n// Date de traitement\nmsg.article.processedDate = new Date().toISOString().split('T')[0];\n\n// Nom de fichier s√©curis√©\nvar safeTitle = msg.article.title.replace(/[^a-zA-Z0-9√Ä-√ø\\s]/g, '').substring(0, 40).replace(/\\s+/g, '_');\nmsg.filename = `articles/${msg.article.category}/${msg.article.processedDate}_${safeTitle}.md`;\n\nnode.warn(`üìÑ Article: ${msg.article.title.substring(0, 50)}...`);\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1300,
        "y": 440,
        "wires": [
            [
                "e4a5576ef4ec20da"
            ]
        ]
    },
    {
        "id": "a0962f8cd2076370",
        "type": "function",
        "z": "a286e71930bddf50",
        "g": "24a5d19a2bf69b70",
        "name": "Config",
        "func": "// ===== RESET COMPLET DES VARIABLES GLOBALES =====\nglobal.set('pipeline_config', null);\nglobal.set('session_stats', null);\n\nnode.warn(\"üßπ RESET: Variables globales vid√©es\");\n\n// ===== NOUVELLE CONFIGURATION FORC√âE =====\nvar config = {\n    max_articles_per_run: 30,\n    enable_deduplication: true,\n    processed_articles: new Set()\n};\n\n// ===== CHOISIR UNE P√âRIODE (d√©commenter UNE ligne) =====\n\n// üïê P√âRIODES COURTES\n// config.hours_lookback = 24;        // Derni√®res 24h\n// config.hours_lookback = 72;        // Derniers 3 jours  \n// config.hours_lookback = 168;       // Derni√®re semaine\n\n// üìÖ P√âRIODES MOYENNES  \nconfig.days_lookback = 30;         // ‚úÖ ACTIF: Dernier mois\n// config.days_lookback = 90;        // 3 derniers mois\n// config.days_lookback = 365;       // Derni√®re ann√©e\n\n// üéØ P√âRIODE SP√âCIFIQUE\n// config.specific_period = {\n//     start_date: '2024-01-01',\n//     end_date: '2024-12-31'\n// };\n\n// üåê TOUS LES ARTICLES (d√©commenter pour d√©sactiver filtrage)\n// config.disable_date_filter = true;\n\n// ===== SAUVEGARDE FORC√âE =====\nglobal.set('pipeline_config', config);\n\nvar session_stats = {\n    execution_id: Date.now(),\n    start_time: new Date().toISOString(),\n    max_articles: config.max_articles_per_run,\n    processed_count: 0,\n    skipped_count: 0\n};\nglobal.set('session_stats', session_stats);\n\n// Configuration flux\nmsg.maxArticles = config.max_articles_per_run;\nmsg.acceptHistorical = true;\n\n// ===== DEBUG CONFIGURATION =====\nnode.warn(\"=== CONFIGURATION ACTIVE ===\");\nif (config.disable_date_filter) {\n    node.warn(\"üåê TOUS LES ARTICLES (aucune limite temporelle)\");\n} else if (config.specific_period) {\n    node.warn(`üìÖ P√âRIODE SP√âCIFIQUE: ${config.specific_period.start_date} ‚Üí ${config.specific_period.end_date}`);\n} else if (config.days_lookback) {\n    node.warn(`üìÖ P√âRIODE: ${config.days_lookback} derniers jours`);\n    var cutoff_date = new Date(Date.now() - (config.days_lookback * 24 * 60 * 60 * 1000));\n    node.warn(`üìÖ ARTICLES ACCEPT√âS DEPUIS: ${cutoff_date.toLocaleDateString('fr-FR')}`);\n} else if (config.hours_lookback) {\n    node.warn(`‚è∞ P√âRIODE: ${config.hours_lookback} derni√®res heures`);\n    var cutoff_date = new Date(Date.now() - (config.hours_lookback * 60 * 60 * 1000));\n    node.warn(`‚è∞ ARTICLES ACCEPT√âS DEPUIS: ${cutoff_date.toLocaleString('fr-FR')}`);\n}\n\nnode.warn(`üéØ LIMITE: ${config.max_articles_per_run} articles max`);\nnode.warn(`üîÑ D√âDUPLICATION: ${config.enable_deduplication ? 'ACTIV√âE' : 'D√âSACTIV√âE'}`);\nnode.warn(\"=========================\");\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 440,
        "wires": [
            [
                "ced5a1942934a354"
            ]
        ]
    },
    {
        "id": "366b4fa1a98cc202",
        "type": "function",
        "z": "a286e71930bddf50",
        "g": "84c6e14812f48c18",
        "name": "Filter Article",
        "func": "// FILTRAGE AVEC DEBUG D√âTAILL√â\nvar session = global.get('session_stats');\nvar config = global.get('pipeline_config');\n\n// V√©rification configuration\nif (!session || !config) {\n    node.error(\"‚ùå Configuration manquante - Relancez le pipeline depuis le d√©but\");\n    return null;\n}\n\n// V√©rification limite absolue\nif (session.processed_count >= session.max_articles) {\n    node.warn(`‚èπÔ∏è LIMITE ATTEINTE: ${session.processed_count}/${session.max_articles} - ARR√äT`);\n    return null;\n}\n\n// Extraction donn√©es article\nvar article = msg.payload;\nif (!article || !article.title) {\n    session.skipped_count++;\n    global.set('session_stats', session);\n    node.warn(\"‚ùå Article invalide (pas de titre)\");\n    return null;\n}\n\n// Debug article\nvar article_date = new Date(article.pubDate || article.pubDateParsed || new Date());\nnode.warn(`üîç ANALYSE: \"${article.title.substring(0, 50)}...\" [${article_date.toLocaleDateString('fr-FR')}]`);\n\n// ID unique pour d√©duplication\nvar title_clean = article.title.replace(/[^a-zA-Z0-9]/g, '').toLowerCase().substring(0, 30);\nvar link_clean = (article.link || '').replace(/[^a-zA-Z0-9]/g, '').toLowerCase().substring(0, 30);\nvar unique_id = `${title_clean}_${link_clean}`;\n\n// Test d√©duplication\nif (config.enable_deduplication && config.processed_articles.has(unique_id)) {\n    session.skipped_count++;\n    global.set('session_stats', session);\n    node.warn(`‚è≠Ô∏è D√âJ√Ä TRAIT√â: ${article.title.substring(0, 40)}...`);\n    return null;\n}\n\n// ===== FILTRAGE TEMPOREL AVEC DEBUG =====\nvar now = new Date();\n\n// Debug config temporelle\nnode.warn(\"üìÖ CONFIG TEMPORELLE:\");\nif (config.disable_date_filter) {\n    node.warn(\"   üåê AUCUNE LIMITE (tous articles accept√©s)\");\n} else if (config.specific_period) {\n    node.warn(`   üìÖ P√âRIODE: ${config.specific_period.start_date} ‚Üí ${config.specific_period.end_date}`);\n} else if (config.days_lookback) {\n    node.warn(`   üìÖ DERNIERS ${config.days_lookback} JOURS`);\n} else if (config.hours_lookback) {\n    node.warn(`   ‚è∞ DERNI√àRES ${config.hours_lookback} HEURES`);\n} else {\n    node.warn(\"   ‚ö†Ô∏è AUCUNE CONFIG TEMPORELLE D√âFINIE\");\n}\n\n// Appliquer le filtrage\nif (config.disable_date_filter) {\n    node.warn(\"   ‚úÖ ACCEPT√â (pas de limite temporelle)\");\n} else if (config.specific_period) {\n    var start_date = new Date(config.specific_period.start_date + 'T00:00:00');\n    var end_date = new Date(config.specific_period.end_date + 'T23:59:59');\n    \n    node.warn(`   üìÖ P√âRIODE: ${start_date.toLocaleDateString()} ‚Üí ${end_date.toLocaleDateString()}`);\n    node.warn(`   üìÖ ARTICLE: ${article_date.toLocaleDateString()}`);\n    \n    if (article_date < start_date || article_date > end_date) {\n        session.skipped_count++;\n        global.set('session_stats', session);\n        node.warn(`   ‚ùå HORS P√âRIODE: ${article.title.substring(0, 40)}...`);\n        return null;\n    }\n    node.warn(\"   ‚úÖ DANS LA P√âRIODE\");\n} else if (config.days_lookback) {\n    var cutoff = new Date(now.getTime() - (config.days_lookback * 24 * 60 * 60 * 1000));\n    \n    node.warn(`   üìÖ LIMITE: ${cutoff.toLocaleDateString('fr-FR')}`);\n    node.warn(`   üìÖ ARTICLE: ${article_date.toLocaleDateString('fr-FR')}`);\n    \n    if (article_date < cutoff) {\n        session.skipped_count++;\n        global.set('session_stats', session);\n        node.warn(`   ‚ùå TROP ANCIEN (>${config.days_lookback} jours)`);\n        return null;\n    }\n    node.warn(\"   ‚úÖ DANS LA P√âRIODE\");\n} else if (config.hours_lookback) {\n    var cutoff = new Date(now.getTime() - (config.hours_lookback * 60 * 60 * 1000));\n    \n    node.warn(`   ‚è∞ LIMITE: ${cutoff.toLocaleString('fr-FR')}`);\n    node.warn(`   ‚è∞ ARTICLE: ${article_date.toLocaleString('fr-FR')}`);\n    \n    if (article_date < cutoff) {\n        session.skipped_count++;\n        global.set('session_stats', session);\n        node.warn(`   ‚ùå TROP ANCIEN (>${config.hours_lookback}h)`);\n        return null;\n    }\n    node.warn(\"   ‚úÖ DANS LA P√âRIODE\");\n}\n\n// Article valid√©\nconfig.processed_articles.add(unique_id);\nsession.processed_count++;\n\n// Nettoyage cache\nif (config.processed_articles.size > 500) {\n    var articles_array = Array.from(config.processed_articles);\n    config.processed_articles = new Set(articles_array.slice(-300));\n}\n\n// Sauvegarder\nglobal.set('pipeline_config', config);\nglobal.set('session_stats', session);\n\nnode.warn(`‚úÖ ARTICLE VALID√â ${session.processed_count}/${session.max_articles}`);\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 970,
        "y": 320,
        "wires": [
            [
                "b8524d09134466d9"
            ]
        ]
    }
]